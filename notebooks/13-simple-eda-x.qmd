---
jupyter: python3
---

```{python}
import matplotlib.pyplot as plt
import seaborn as sns
import pandas as pd
import json

```

```{python}
df = pd.read_parquet("../data/processed/x_posts.parquet")
df.head(5)
```

```{python}
df["searchkeyword"].value_counts()
```

```{python}
value_counts = df['searchkeyword'].value_counts().reset_index()
value_counts.columns = ['searchkeyword', 'count']

plt.style.use('dark_background')

sns.set_theme(style="dark")

plt.figure(figsize=(12, 6))
ax = sns.barplot(
    data=value_counts,
    x='searchkeyword',
    y='count',
    hue='searchkeyword',
    dodge=False,
    palette='viridis',
    legend=False
)

plt.xlabel('Search Keyword', color='white')
plt.ylabel('Anzahl', color='white')
plt.title('Count of Search Keywords', color='white')

plt.xticks(rotation=45, ha='right', color='white')
plt.yticks(color='white')

ax.set_facecolor('black')
fig = plt.gcf()
fig.patch.set_facecolor('black')

for spine in ax.spines.values():
    spine.set_color('white')

ax.tick_params(colors='white', which='both')

ax.grid(True, color='gray', linestyle='--', linewidth=0.5)

for p in ax.patches:
    height = p.get_height()
    ax.text(
        x=p.get_x() + p.get_width() / 2,
        y=height + 0.02 * max(value_counts['count']),
        s=f'{int(height)}',
        ha='center',
        color='white',
        fontsize=10
    )

plt.tight_layout()
plt.show()
```

```{python}
with open('../data/raw/coins.json', 'r') as f:
    coins_data = json.load(f)

coin_to_dates = {}
for coin in coins_data:
    coin_name = coin['name']
    start_date_str = coin['start_date']
    end_date_str = coin['end_date'] or '2024-11-01'  # Use '2024-11-01' if end_date is null
    start_date = pd.to_datetime(start_date_str)
    end_date = pd.to_datetime(end_date_str)
    coin_to_dates[coin_name] = (start_date, end_date)

keyword_to_coin = {
    'Bitcoin': 'Bitcoin',
    'Ethereum': 'Ethereum',
    'Chainlink': 'Chainlink',
    'thorchain': 'THORChain',
    '$Atom': 'Cosmos',
    'Bitforex': 'BitForex',
    '$Avax': 'Avalanche',
    'Terra Luna': 'Terra Luna',
    '$FTT': 'FTX Token',
    'Safemoon': 'Safe Moon',
    '$STA': 'STOA Network',
    'Beercoin': 'BeerCoin',
    'Teddy Doge': 'Teddy Doge'
}

df_keywords = ['Bitcoin', 'Ethereum', 'Chainlink', 'thorchain', '$Atom', 'Bitforex', '$Avax', 'Terra Luna', '$FTT', 'Safemoon', '$STA', 'Beercoin', 'Teddy Doge']
missing_keywords = set(df_keywords) - set(keyword_to_coin.keys())
if missing_keywords:
    print(f"Missing mappings for keywords: {missing_keywords}")

df['timestamp'] = pd.to_datetime(df['timestamp'])
df['date'] = df['timestamp'].dt.date
grouped = df.groupby(['searchkeyword', 'date']).size().reset_index(name='count')
grouped = grouped.sort_values('date')
keywords = df['searchkeyword'].unique()
N = len(keywords)
fig, axes = plt.subplots(N, 1, figsize=(12, N * 2), sharex=True)

for i, keyword in enumerate(keywords):
    ax = axes[i] if N > 1 else axes
    data = grouped[grouped['searchkeyword'] == keyword]
    data = data.set_index('date').reindex(
        pd.date_range(start=grouped['date'].min(), end=grouped['date'].max()), fill_value=0
    )
    data['count_smooth'] = data['count']
    ax.plot(data.index, data['count_smooth'])
    ax.set_title(keyword)
    ax.set_ylabel('Count')
    
    coin_name = keyword_to_coin.get(keyword)
    if coin_name:
        start_date, end_date = coin_to_dates.get(coin_name, (None, None))
        if start_date and end_date:
            ax.axvline(x=start_date, color='red', linestyle='--')
            ax.axvline(x=end_date, color='red', linestyle='--')
    
    if i == N - 1:
        ax.set_xlabel('Date')
    else:
        ax.set_xlabel('')
    ax.tick_params(axis='x', rotation=45)
    ax.grid(True)

plt.tight_layout()
plt.subplots_adjust(hspace=0.3)
plt.show()
```

